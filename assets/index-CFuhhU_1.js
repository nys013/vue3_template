import{H as R,d as j,n as m,I as W,q as K,B as A,J as q,r as n,o as B,b as I,w as o,g as O,e,k as b,i as D,E as y,c as F,h as P,K as H,_ as J}from"./index-BGHD8BrC.js";const G=({page:r,limit:t},p="")=>R.get(`/admin/acl/role/${r}/${t}`+(p?`?${p}`:"")),Q=(r,t={})=>r.id?R.put("/admin/acl/role/update",r,t):R.post("/admin/acl/role/save",r,t),X=(r,t={})=>R.delete(`/admin/acl/role/remove/${r}`,t),Y=(r,t={})=>R.delete("/admin/acl/role/batchRemove",{data:r,...t}),Z=(r,t={})=>R.get(`/admin/acl/permission/toAssign/${r}`,t),ee=(r,t,p={})=>R.post(`/admin/acl/permission/doAssign/?roleId=${r}&permissionId=${t}`,p),oe={class:"dialog-footer"},te=j({__name:"DialogAddOrUpdate",props:{action:{type:String,default:"A"},rowData:{type:Object,default:()=>({})}},emits:["update:dialogVisible","dialog-confirm"],setup(r,{emit:t}){const p=t,i=r,d=m(!1);let h=W(()=>i.action==="A"?"新增角色":"修改角色");K(()=>{d.value=!0,i.action=="U"&&Object.assign(f,i.rowData)});const v=m(),f=A({roleName:""}),g=q("formValidate"),x=A({roleName:g({required:!0})}),k=async()=>{await v.value.validate();try{const _=await Q(f,{showLoading:!0});_.code===200?(y.success((i.action==="A"?"新增":"修改")+"成功"),d.value=!1,p("dialog-confirm")):y.error(_.message)}catch{}},$=()=>{p("update:dialogVisible",!1)};return(_,s)=>{const l=n("el-input"),w=n("el-form-item"),T=n("el-form"),N=n("el-button"),c=n("el-dialog");return B(),I(c,{modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=a=>d.value=a),title:D(h),width:"500px","show-close":!1,onClose:$},{footer:o(()=>[O("span",oe,[e(N,{onClick:s[1]||(s[1]=a=>d.value=!1)},{default:o(()=>[b("关闭")]),_:1}),e(N,{type:"primary",onClick:k},{default:o(()=>[b(" 确认 ")]),_:1})])]),default:o(()=>[e(T,{ref_key:"formRef",ref:v,model:f,rules:x,"label-width":"100px","status-icon":"",class:"form-wrapper"},{default:o(()=>[e(w,{label:"角色名",prop:"roleName"},{default:o(()=>[e(l,{modelValue:f.roleName,"onUpdate:modelValue":s[0]||(s[0]=a=>f.roleName=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),le={class:"drawer-footer"},ae=j({__name:"DrawerPermission",props:{rowData:{type:Object,default:()=>({})}},emits:["update:drawerVisible","drawer-confirm"],setup(r,{emit:t}){const p=t,i=r,d=m(!1),h={children:"children",label:"name"},v=A({roleName:""}),f=m([]);K(async()=>{d.value=!0,Object.assign(v,i.rowData);const s=await Z(i.rowData.id,{showLoading:!0});s.code===200&&(f.value=s.data.slice(0,1))});const g=W(()=>x(f.value)),x=(s,l=!1)=>s.map(w=>w.children&&w.children.length?x(w.children):l||w.select?w.id:0).flat().filter(Boolean),k=m(),$=async()=>{try{const s=[...k.value.getCheckedKeys(),...k.value.getHalfCheckedKeys()],l=await ee(i.rowData.id,s,{showLoading:!0});l.code===200?(y.success("分配成功"),window.location.reload()):y.error(l.message)}catch{}},_=()=>{p("update:drawerVisible",!1)};return(s,l)=>{const w=n("el-input"),T=n("el-form-item"),N=n("el-tree"),c=n("el-form"),a=n("el-button"),U=n("el-drawer");return B(),I(U,{modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=C=>d.value=C),title:"分配权限",direction:"rtl","show-close":!1,onClose:_},{footer:o(()=>[O("span",le,[e(a,{onClick:l[1]||(l[1]=C=>d.value=!1)},{default:o(()=>[b("关闭")]),_:1}),e(a,{type:"primary",onClick:$},{default:o(()=>[b(" 确认 ")]),_:1})])]),default:o(()=>[e(c,{ref:"formRef",model:v,"label-width":"60px","status-icon":"",class:"form-wrapper"},{default:o(()=>[e(T,{label:"角色名",prop:"roleName"},{default:o(()=>[e(w,{modelValue:v.roleName,"onUpdate:modelValue":l[0]||(l[0]=C=>v.roleName=C),disabled:!0},null,8,["modelValue"])]),_:1}),e(N,{ref_key:"treeRef",ref:k,data:f.value,"show-checkbox":"","node-key":"id","default-checked-keys":g.value,"default-expanded-keys":[1],props:h},null,8,["data","default-checked-keys"])]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),re={class:"search-wrapper"},ne={class:"btn-wrapper"},se=j({name:"Role"}),ie=j({...se,setup(r){const t=m(),p=A({requestFn:G,showIndex:!0,showSelection:!0,columns:[{label:"ID",prop:"id",minWidth:80},{label:"角色名",prop:"roleName",minWidth:150},{label:"创建时间",prop:"createTime",minWidth:150,"show-overflow-tooltip":!0},{label:"更新时间",prop:"updateTime",minWidth:150,"show-overflow-tooltip":!0},{label:"操作",prop:"operation",minWidth:250,slot:"operation"}]}),i=m(!1);let d=m(""),h=m();const v=()=>{i.value=!0,d.value="A"},f=c=>{i.value=!0,d.value="U",h.value=c},g=m([]),x=()=>{H.confirm("确定删除选中角色?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const c=g.value.map(U=>U.id);(await Y(c,{showLoading:!0})).code===200?(y.success("删除成功"),t.value.getTableData()):y.error("删除失败")}catch{}})},k=async c=>{if(c.id)try{(await X(c.id)).code===200?(y.success("删除成功"),t.value.getTableData()):y.error("删除失败")}catch{}},$=()=>{t.value.getTableData()},_=m(!1),s=c=>{_.value=!0,h.value=c};let l=A({roleName:""});const w=m(),T=()=>{t.value.searchTable(l)},N=()=>{l.roleName="",t.value.searchTable()};return(c,a)=>{const U=n("el-input"),C=n("el-form-item"),V=n("el-button"),L=n("el-form"),z=n("el-popconfirm"),M=n("TableCreate"),S=n("el-card");return B(),F("div",null,[O("div",re,[e(L,{ref_key:"formRef",ref:w,inline:!0,model:D(l),class:"form-inline"},{default:o(()=>[e(C,{label:"角色名"},{default:o(()=>[e(U,{modelValue:D(l).roleName,"onUpdate:modelValue":a[0]||(a[0]=u=>D(l).roleName=u),placeholder:"请输入角色名关键字",clearable:""},null,8,["modelValue"])]),_:1}),e(C,{"label-width":"0"},{default:o(()=>[e(V,{type:"primary",onClick:T},{default:o(()=>[b("搜索")]),_:1}),e(V,{type:"primary",onClick:N},{default:o(()=>[b("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),O("div",ne,[e(V,{type:"primary",onClick:v},{default:o(()=>[b(" 新增 ")]),_:1}),e(V,{type:"danger",onClick:x,disabled:!g.value.length},{default:o(()=>[b(" 批量删除 ")]),_:1},8,["disabled"])]),e(S,{class:"box-card"},{default:o(()=>[e(M,{ref_key:"tableDom",ref:t,tableOptions:p,selectedRows:g.value,"onUpdate:selectedRows":a[1]||(a[1]=u=>g.value=u)},{operation:o(({scope:u})=>[e(V,{size:"small",type:"primary",onClick:E=>f(u.row)},{default:o(()=>[b(" 修改 ")]),_:2},1032,["onClick"]),e(z,{title:`你确定要删除${u.row.roleName}?`,width:"260px",onConfirm:E=>k(u.row)},{reference:o(()=>[e(V,{type:"danger",size:"small"},{default:o(()=>[b(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"]),e(V,{size:"small",type:"primary",onClick:E=>s(u.row)},{default:o(()=>[b(" 分配权限 ")]),_:2},1032,["onClick"])]),_:1},8,["tableOptions","selectedRows"])]),_:1}),i.value?(B(),I(te,{key:0,dialogVisible:i.value,"onUpdate:dialogVisible":a[2]||(a[2]=u=>i.value=u),rowData:D(h),action:D(d),onDialogConfirm:$},null,8,["dialogVisible","rowData","action"])):P("",!0),_.value?(B(),I(ae,{key:1,drawerVisible:_.value,"onUpdate:drawerVisible":a[3]||(a[3]=u=>_.value=u),rowData:D(h),onDrawerConfirm:$},null,8,["drawerVisible","rowData"])):P("",!0)])}}}),ce=J(ie,[["__scopeId","data-v-73619faf"]]);export{ce as default};
