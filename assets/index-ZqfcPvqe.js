import{D as T,d as j,n as _,G as H,q as F,z as S,H as P,m as W,r as d,o as R,b as B,w as e,g as N,e as t,k as v,h as q,i as A,E as y,c as M,F as J,a as K,t as Q,I as X,_ as Y}from"./index-HRP16b-e.js";const Z=({page:r,limit:s},V="")=>T.get(`/admin/acl/user/${r}/${s}`+(V?`?${V}`:"")),ee=(r,s={})=>r.id?T.put("/admin/acl/user/update",r,s):T.post("/admin/acl/user/save",r,s),le=(r,s={})=>T.delete(`/admin/acl/user/remove/${r}`,s),te=(r,s={})=>T.delete("/admin/acl/user/batchRemove",{data:r,...s}),ae=r=>T.get(`/admin/acl/user/toAssign/${r}`),oe=(r,s={})=>T.post("/admin/acl/user/doAssignRole",r,s),se={class:"dialog-footer"},ne=j({__name:"DialogAddOrUpdate",props:{action:{type:String,default:"A"},rowData:{type:Object,default:()=>({})}},emits:["update:dialogVisible","dialog-confirm"],setup(r,{emit:s}){const V=s,i=r,m=_(!1);let g=H(()=>i.action==="A"?"新增用户":"修改用户");F(()=>{m.value=!0,i.action=="U"&&Object.assign(c,i.rowData)});const D=_(),c=S({username:"",name:"",password:""}),p=P("formValidate"),C=S({username:p({required:!0,type:"username"}),name:p({required:!0}),password:p({required:!0,type:"password"})}),O=W(),h=async()=>{await D.value.validate();try{const x=await ee(c,{showLoading:!0});x.code===200?(y.success((i.action==="A"?"新增":"修改")+"成功"),i.rowData.username===O.username?window.location.reload():(m.value=!1,V("dialog-confirm"))):y.error(x.message)}catch{}},U=()=>{V("update:dialogVisible",!1)};return(x,o)=>{const $=d("el-input"),n=d("el-form-item"),a=d("el-form"),u=d("el-button"),l=d("el-dialog");return R(),B(l,{modelValue:m.value,"onUpdate:modelValue":o[4]||(o[4]=f=>m.value=f),title:A(g),width:"500px","show-close":!1,onClose:U},{footer:e(()=>[N("span",se,[t(u,{onClick:o[3]||(o[3]=f=>m.value=!1)},{default:e(()=>o[5]||(o[5]=[v("关闭")])),_:1}),t(u,{type:"primary",onClick:h},{default:e(()=>o[6]||(o[6]=[v(" 确认 ")])),_:1})])]),default:e(()=>[t(a,{ref_key:"formRef",ref:D,model:c,rules:C,"label-width":"100px","status-icon":"",class:"form-wrapper"},{default:e(()=>[t(n,{label:"用户名",prop:"username"},{default:e(()=>[t($,{modelValue:c.username,"onUpdate:modelValue":o[0]||(o[0]=f=>c.username=f)},null,8,["modelValue"])]),_:1}),t(n,{label:"名字",prop:"name"},{default:e(()=>[t($,{modelValue:c.name,"onUpdate:modelValue":o[1]||(o[1]=f=>c.name=f)},null,8,["modelValue"])]),_:1}),r.action==="A"?(R(),B(n,{key:0,label:"密码",prop:"password"},{default:e(()=>[t($,{"show-password":"",type:"password",modelValue:c.password,"onUpdate:modelValue":o[2]||(o[2]=f=>c.password=f)},null,8,["modelValue"])]),_:1})):q("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),re={class:"drawer-footer"},de=j({__name:"DrawerSetRoles",props:{rowData:{type:Object,default:()=>({})}},emits:["update:drawerVisible","drawer-confirm"],setup(r,{emit:s}){const V=s,i=r,m=_(!1),g=S({username:"",checkedRoles:[]}),D=_(!1),c=_(!1),p=_([]),C=_([]),O=n=>{p.value=n?C.value.map(a=>a.id):[],c.value=!1},h=n=>{c.value=n>0&&n<C.value.length,D.value=n===C.value.length},U=n=>{const a=n.length;h(a)};F(async()=>{m.value=!0,Object.assign(g,i.rowData);const n=await ae(i.rowData.id);n.code===200&&(C.value=n.data.allRolesList,p.value=n.data.assignRoles.map(a=>a.id),h(p.value.length))});const x=W(),o=async()=>{try{const n={userId:i.rowData.id,roleIdList:p.value},a=await oe(n,{showLoading:!0});a.code===200?(y.success("分配成功"),i.rowData.username===x.username?window.location.reload():(m.value=!1,V("drawer-confirm"))):y.error(a.message)}catch{}},$=()=>{V("update:drawerVisible",!1)};return(n,a)=>{const u=d("el-input"),l=d("el-form-item"),f=d("el-checkbox"),I=d("el-checkbox-group"),k=d("el-form"),L=d("el-button"),E=d("el-drawer");return R(),B(E,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=w=>m.value=w),title:"分配角色",direction:"rtl","show-close":!1,onClose:$},{footer:e(()=>[N("span",re,[t(L,{onClick:a[3]||(a[3]=w=>m.value=!1)},{default:e(()=>a[6]||(a[6]=[v("关闭")])),_:1}),t(L,{type:"primary",onClick:o},{default:e(()=>a[7]||(a[7]=[v(" 确认 ")])),_:1})])]),default:e(()=>[t(k,{ref:"formRef",model:g,"label-width":"80px","status-icon":"",class:"form-wrapper"},{default:e(()=>[t(l,{label:"用户名",prop:"username"},{default:e(()=>[t(u,{modelValue:g.username,"onUpdate:modelValue":a[0]||(a[0]=w=>g.username=w),disabled:!0},null,8,["modelValue"])]),_:1}),t(l,{label:"分配角色",prop:"checkedRoles"},{default:e(()=>[t(f,{modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=w=>D.value=w),indeterminate:c.value,onChange:O},{default:e(()=>a[5]||(a[5]=[v("全选")])),_:1},8,["modelValue","indeterminate"]),t(I,{modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=w=>p.value=w),onChange:U},{default:e(()=>[(R(!0),M(J,null,K(C.value,w=>(R(),B(f,{key:w.id,label:w.id},{default:e(()=>[v(Q(w.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ie={class:"search-wrapper"},ue={class:"btn-wrapper"},me=j({name:"User"}),ce=j({...me,setup(r){const s=_(),V=S({requestFn:Z,showIndex:!0,showSelection:!0,columns:[{label:"用户名",prop:"username",minWidth:150},{label:"名字",prop:"name",minWidth:150},{label:"角色",prop:"roleName",minWidth:150},{label:"操作",prop:"operation",minWidth:250,slot:"operation"}]}),i=_(!1);let m=_(""),g=_();const D=()=>{i.value=!0,m.value="A"},c=u=>{i.value=!0,m.value="U",g.value=u},p=_([]),C=()=>{X.confirm("确定删除选中用户?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const u=p.value.map(f=>f.id);(await te(u,{showLoading:!0})).code===200?(y.success("删除成功"),s.value.getTableData()):y.error("删除失败")}catch{}})},O=async u=>{if(!u.id)return y.success("该数据不能删除");try{(await le(u.id,{showLoading:!0})).code===200?(y.success("删除成功"),s.value.getTableData()):y.error("删除失败")}catch{}},h=()=>{s.value.getTableData()},U=_(!1),x=u=>{U.value=!0,g.value=u};let o=S({username:""});const $=_(),n=()=>{s.value.searchTable(o)},a=()=>{o.username="",s.value.searchTable()};return(u,l)=>{const f=d("el-input"),I=d("el-form-item"),k=d("el-button"),L=d("el-form"),E=d("el-popconfirm"),w=d("TableCreate"),G=d("el-card");return R(),M("div",null,[N("div",ie,[t(L,{ref_key:"formRef",ref:$,inline:!0,model:A(o),class:"form-inline"},{default:e(()=>[t(I,{label:"用户名"},{default:e(()=>[t(f,{modelValue:A(o).username,"onUpdate:modelValue":l[0]||(l[0]=b=>A(o).username=b),placeholder:"请输入用户名关键字",clearable:""},null,8,["modelValue"])]),_:1}),t(I,{"label-width":"0"},{default:e(()=>[t(k,{type:"primary",onClick:n},{default:e(()=>l[4]||(l[4]=[v("搜索")])),_:1}),t(k,{type:"primary",onClick:a},{default:e(()=>l[5]||(l[5]=[v("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),N("div",ue,[t(k,{type:"primary",onClick:D},{default:e(()=>l[6]||(l[6]=[v(" 新增 ")])),_:1}),t(k,{type:"danger",onClick:C,disabled:!p.value.length},{default:e(()=>l[7]||(l[7]=[v(" 批量删除 ")])),_:1},8,["disabled"])]),t(G,{class:"box-card"},{default:e(()=>[t(w,{ref_key:"tableDom",ref:s,tableOptions:V,selectedRows:p.value,"onUpdate:selectedRows":l[1]||(l[1]=b=>p.value=b)},{operation:e(({scope:b})=>[t(k,{size:"small",type:"primary",onClick:z=>c(b.row)},{default:e(()=>l[8]||(l[8]=[v(" 修改 ")])),_:2},1032,["onClick"]),t(E,{title:`你确定要删除${b.row.username}?`,width:"260px",onConfirm:z=>O(b.row)},{reference:e(()=>[t(k,{type:"danger",size:"small"},{default:e(()=>l[9]||(l[9]=[v(" 删除 ")])),_:1})]),_:2},1032,["title","onConfirm"]),t(k,{size:"small",type:"primary",onClick:z=>x(b.row)},{default:e(()=>l[10]||(l[10]=[v(" 分配角色 ")])),_:2},1032,["onClick"])]),_:1},8,["tableOptions","selectedRows"])]),_:1}),i.value?(R(),B(ne,{key:0,dialogVisible:i.value,"onUpdate:dialogVisible":l[2]||(l[2]=b=>i.value=b),rowData:A(g),action:A(m),onDialogConfirm:h},null,8,["dialogVisible","rowData","action"])):q("",!0),U.value?(R(),B(de,{key:1,drawerVisible:U.value,"onUpdate:drawerVisible":l[3]||(l[3]=b=>U.value=b),rowData:A(g),onDrawerConfirm:h},null,8,["drawerVisible","rowData"])):q("",!0)])}}}),fe=Y(ce,[["__scopeId","data-v-1d635254"]]);export{fe as default};
