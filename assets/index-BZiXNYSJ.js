import{H as T,d as j,n as w,I as J,q as W,B as S,J as K,m as z,r,o as x,b as B,w as e,g as N,e as a,k as v,h as q,i as A,E as k,c as M,F as P,a as G,t as Q,K as X,_ as Y}from"./index-DrfQjD1h.js";const Z=({page:s,limit:t},V="")=>T.get(`/admin/acl/user/${s}/${t}`+(V?`?${V}`:"")),ee=(s,t={})=>s.id?T.put("/admin/acl/user/update",s,t):T.post("/admin/acl/user/save",s,t),ae=(s,t={})=>T.delete(`/admin/acl/user/remove/${s}`,t),le=(s,t={})=>T.delete("/admin/acl/user/batchRemove",{data:s,...t}),te=s=>T.get(`/admin/acl/user/toAssign/${s}`),oe=(s,t={})=>T.post("/admin/acl/user/doAssignRole",s,t),se={class:"dialog-footer"},ne=j({__name:"DialogAddOrUpdate",props:{action:{type:String,default:"A"},rowData:{type:Object,default:()=>({})}},emits:["update:dialogVisible","dialog-confirm"],setup(s,{emit:t}){const V=t,d=s,c=w(!1);let g=J(()=>d.action==="A"?"新增用户":"修改用户");W(()=>{c.value=!0,d.action=="U"&&Object.assign(m,d.rowData)});const y=w(),m=S({username:"",name:"",password:""}),p=K("formValidate"),h=S({username:p({required:!0,type:"username"}),name:p({required:!0}),password:p({required:!0,type:"password"})}),O=z(),R=async()=>{await y.value.validate();try{const U=await ee(m,{showLoading:!0});U.code===200?(k.success((d.action==="A"?"新增":"修改")+"成功"),d.rowData.username===O.username?window.location.reload():(c.value=!1,V("dialog-confirm"))):k.error(U.message)}catch{}},D=()=>{V("update:dialogVisible",!1)};return(U,n)=>{const $=r("el-input"),o=r("el-form-item"),l=r("el-form"),i=r("el-button"),u=r("el-dialog");return x(),B(u,{modelValue:c.value,"onUpdate:modelValue":n[4]||(n[4]=f=>c.value=f),title:A(g),width:"500px","show-close":!1,onClose:D},{footer:e(()=>[N("span",se,[a(i,{onClick:n[3]||(n[3]=f=>c.value=!1)},{default:e(()=>[v("关闭")]),_:1}),a(i,{type:"primary",onClick:R},{default:e(()=>[v(" 确认 ")]),_:1})])]),default:e(()=>[a(l,{ref_key:"formRef",ref:y,model:m,rules:h,"label-width":"100px","status-icon":"",class:"form-wrapper"},{default:e(()=>[a(o,{label:"用户名",prop:"username"},{default:e(()=>[a($,{modelValue:m.username,"onUpdate:modelValue":n[0]||(n[0]=f=>m.username=f)},null,8,["modelValue"])]),_:1}),a(o,{label:"名字",prop:"name"},{default:e(()=>[a($,{modelValue:m.name,"onUpdate:modelValue":n[1]||(n[1]=f=>m.name=f)},null,8,["modelValue"])]),_:1}),s.action==="A"?(x(),B(o,{key:0,label:"密码",prop:"password"},{default:e(()=>[a($,{"show-password":"",type:"password",modelValue:m.password,"onUpdate:modelValue":n[2]||(n[2]=f=>m.password=f)},null,8,["modelValue"])]),_:1})):q("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),re={class:"drawer-footer"},de=j({__name:"DrawerSetRoles",props:{rowData:{type:Object,default:()=>({})}},emits:["update:drawerVisible","drawer-confirm"],setup(s,{emit:t}){const V=t,d=s,c=w(!1),g=S({username:"",checkedRoles:[]}),y=w(!1),m=w(!1),p=w([]),h=w([]),O=o=>{p.value=o?h.value.map(l=>l.id):[],m.value=!1},R=o=>{m.value=o>0&&o<h.value.length,y.value=o===h.value.length},D=o=>{const l=o.length;R(l)};W(async()=>{c.value=!0,Object.assign(g,d.rowData);const o=await te(d.rowData.id);o.code===200&&(h.value=o.data.allRolesList,p.value=o.data.assignRoles.map(l=>l.id),R(p.value.length))});const U=z(),n=async()=>{try{const o={userId:d.rowData.id,roleIdList:p.value},l=await oe(o,{showLoading:!0});l.code===200?(k.success("分配成功"),d.rowData.username===U.username?window.location.reload():(c.value=!1,V("drawer-confirm"))):k.error(l.message)}catch{}},$=()=>{V("update:drawerVisible",!1)};return(o,l)=>{const i=r("el-input"),u=r("el-form-item"),f=r("el-checkbox"),I=r("el-checkbox-group"),C=r("el-form"),L=r("el-button"),E=r("el-drawer");return x(),B(E,{modelValue:c.value,"onUpdate:modelValue":l[4]||(l[4]=_=>c.value=_),title:"分配角色",direction:"rtl","show-close":!1,onClose:$},{footer:e(()=>[N("span",re,[a(L,{onClick:l[3]||(l[3]=_=>c.value=!1)},{default:e(()=>[v("关闭")]),_:1}),a(L,{type:"primary",onClick:n},{default:e(()=>[v(" 确认 ")]),_:1})])]),default:e(()=>[a(C,{ref:"formRef",model:g,"label-width":"80px","status-icon":"",class:"form-wrapper"},{default:e(()=>[a(u,{label:"用户名",prop:"username"},{default:e(()=>[a(i,{modelValue:g.username,"onUpdate:modelValue":l[0]||(l[0]=_=>g.username=_),disabled:!0},null,8,["modelValue"])]),_:1}),a(u,{label:"分配角色",prop:"checkedRoles"},{default:e(()=>[a(f,{modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=_=>y.value=_),indeterminate:m.value,onChange:O},{default:e(()=>[v("全选")]),_:1},8,["modelValue","indeterminate"]),a(I,{modelValue:p.value,"onUpdate:modelValue":l[2]||(l[2]=_=>p.value=_),onChange:D},{default:e(()=>[(x(!0),M(P,null,G(h.value,_=>(x(),B(f,{key:_.id,label:_.id},{default:e(()=>[v(Q(_.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ie={class:"search-wrapper"},ue={class:"btn-wrapper"},ce=j({name:"User"}),me=j({...ce,setup(s){const t=w(),V=S({requestFn:Z,showIndex:!0,showSelection:!0,columns:[{label:"用户名",prop:"username",minWidth:150},{label:"名字",prop:"name",minWidth:150},{label:"角色",prop:"roleName",minWidth:150},{label:"操作",prop:"operation",minWidth:250,slot:"operation"}]}),d=w(!1);let c=w(""),g=w();const y=()=>{d.value=!0,c.value="A"},m=i=>{d.value=!0,c.value="U",g.value=i},p=w([]),h=()=>{X.confirm("确定删除选中用户?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const i=p.value.map(f=>f.id);(await le(i,{showLoading:!0})).code===200?(k.success("删除成功"),t.value.getTableData()):k.error("删除失败")}catch{}})},O=async i=>{if(!i.id)return k.success("该数据不能删除");try{(await ae(i.id,{showLoading:!0})).code===200?(k.success("删除成功"),t.value.getTableData()):k.error("删除失败")}catch{}},R=()=>{t.value.getTableData()},D=w(!1),U=i=>{D.value=!0,g.value=i};let n=S({username:""});const $=w(),o=()=>{t.value.searchTable(n)},l=()=>{n.username="",t.value.searchTable()};return(i,u)=>{const f=r("el-input"),I=r("el-form-item"),C=r("el-button"),L=r("el-form"),E=r("el-popconfirm"),_=r("TableCreate"),H=r("el-card");return x(),M("div",null,[N("div",ie,[a(L,{ref_key:"formRef",ref:$,inline:!0,model:A(n),class:"form-inline"},{default:e(()=>[a(I,{label:"用户名"},{default:e(()=>[a(f,{modelValue:A(n).username,"onUpdate:modelValue":u[0]||(u[0]=b=>A(n).username=b),placeholder:"请输入用户名关键字",clearable:""},null,8,["modelValue"])]),_:1}),a(I,{"label-width":"0"},{default:e(()=>[a(C,{type:"primary",onClick:o},{default:e(()=>[v("搜索")]),_:1}),a(C,{type:"primary",onClick:l},{default:e(()=>[v("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),N("div",ue,[a(C,{type:"primary",onClick:y},{default:e(()=>[v(" 新增 ")]),_:1}),a(C,{type:"danger",onClick:h,disabled:!p.value.length},{default:e(()=>[v(" 批量删除 ")]),_:1},8,["disabled"])]),a(H,{class:"box-card"},{default:e(()=>[a(_,{ref_key:"tableDom",ref:t,tableOptions:V,selectedRows:p.value,"onUpdate:selectedRows":u[1]||(u[1]=b=>p.value=b)},{operation:e(({scope:b})=>[a(C,{size:"small",type:"primary",onClick:F=>m(b.row)},{default:e(()=>[v(" 修改 ")]),_:2},1032,["onClick"]),a(E,{title:`你确定要删除${b.row.username}?`,width:"260px",onConfirm:F=>O(b.row)},{reference:e(()=>[a(C,{type:"danger",size:"small"},{default:e(()=>[v(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"]),a(C,{size:"small",type:"primary",onClick:F=>U(b.row)},{default:e(()=>[v(" 分配角色 ")]),_:2},1032,["onClick"])]),_:1},8,["tableOptions","selectedRows"])]),_:1}),d.value?(x(),B(ne,{key:0,dialogVisible:d.value,"onUpdate:dialogVisible":u[2]||(u[2]=b=>d.value=b),rowData:A(g),action:A(c),onDialogConfirm:R},null,8,["dialogVisible","rowData","action"])):q("",!0),D.value?(x(),B(de,{key:1,drawerVisible:D.value,"onUpdate:drawerVisible":u[3]||(u[3]=b=>D.value=b),rowData:A(g),onDrawerConfirm:R},null,8,["drawerVisible","rowData"])):q("",!0)])}}}),fe=Y(me,[["__scopeId","data-v-1d635254"]]);export{fe as default};
