import{D as R,d as j,n as c,G as W,q as z,z as A,H as q,r as s,o as B,b as I,w as t,g as O,e as o,k as b,i as h,E as k,c as F,h as P,I as H,_ as G}from"./index-DscIuvd5.js";const J=({page:n,limit:l},p="")=>R.get(`/admin/acl/role/${n}/${l}`+(p?`?${p}`:"")),Q=(n,l={})=>n.id?R.put("/admin/acl/role/update",n,l):R.post("/admin/acl/role/save",n,l),X=(n,l={})=>R.delete(`/admin/acl/role/remove/${n}`,l),Y=(n,l={})=>R.delete("/admin/acl/role/batchRemove",{data:n,...l}),Z=(n,l={})=>R.get(`/admin/acl/permission/toAssign/${n}`,l),ee=(n,l,p={})=>R.post(`/admin/acl/permission/doAssign/?roleId=${n}&permissionId=${l}`,p),oe={class:"dialog-footer"},te=j({__name:"DialogAddOrUpdate",props:{action:{type:String,default:"A"},rowData:{type:Object,default:()=>({})}},emits:["update:dialogVisible","dialog-confirm"],setup(n,{emit:l}){const p=l,i=n,d=c(!1);let g=W(()=>i.action==="A"?"新增角色":"修改角色");z(()=>{d.value=!0,i.action=="U"&&Object.assign(f,i.rowData)});const v=c(),f=A({roleName:""}),y=q("formValidate"),x=A({roleName:y({required:!0})}),C=async()=>{await v.value.validate();try{const _=await Q(f,{showLoading:!0});_.code===200?(k.success((i.action==="A"?"新增":"修改")+"成功"),d.value=!1,p("dialog-confirm")):k.error(_.message)}catch{}},$=()=>{p("update:dialogVisible",!1)};return(_,r)=>{const a=s("el-input"),w=s("el-form-item"),T=s("el-form"),N=s("el-button"),u=s("el-dialog");return B(),I(u,{modelValue:d.value,"onUpdate:modelValue":r[2]||(r[2]=e=>d.value=e),title:h(g),width:"500px","show-close":!1,onClose:$},{footer:t(()=>[O("span",oe,[o(N,{onClick:r[1]||(r[1]=e=>d.value=!1)},{default:t(()=>r[3]||(r[3]=[b("关闭")])),_:1}),o(N,{type:"primary",onClick:C},{default:t(()=>r[4]||(r[4]=[b(" 确认 ")])),_:1})])]),default:t(()=>[o(T,{ref_key:"formRef",ref:v,model:f,rules:x,"label-width":"100px","status-icon":"",class:"form-wrapper"},{default:t(()=>[o(w,{label:"角色名",prop:"roleName"},{default:t(()=>[o(a,{modelValue:f.roleName,"onUpdate:modelValue":r[0]||(r[0]=e=>f.roleName=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),le={class:"drawer-footer"},ae=j({__name:"DrawerPermission",props:{rowData:{type:Object,default:()=>({})}},emits:["update:drawerVisible","drawer-confirm"],setup(n,{emit:l}){const p=l,i=n,d=c(!1),g={children:"children",label:"name"},v=A({roleName:""}),f=c([]);z(async()=>{d.value=!0,Object.assign(v,i.rowData);const r=await Z(i.rowData.id,{showLoading:!0});r.code===200&&(f.value=r.data.slice(0,1))});const y=W(()=>x(f.value)),x=(r,a=!1)=>r.map(w=>w.children&&w.children.length?x(w.children):a||w.select?w.id:0).flat().filter(Boolean),C=c(),$=async()=>{try{const r=[...C.value.getCheckedKeys(),...C.value.getHalfCheckedKeys()],a=await ee(i.rowData.id,r,{showLoading:!0});a.code===200?(k.success("分配成功"),window.location.reload()):k.error(a.message)}catch{}},_=()=>{p("update:drawerVisible",!1)};return(r,a)=>{const w=s("el-input"),T=s("el-form-item"),N=s("el-tree"),u=s("el-form"),e=s("el-button"),U=s("el-drawer");return B(),I(U,{modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=V=>d.value=V),title:"分配权限",direction:"rtl","show-close":!1,onClose:_},{footer:t(()=>[O("span",le,[o(e,{onClick:a[1]||(a[1]=V=>d.value=!1)},{default:t(()=>a[3]||(a[3]=[b("关闭")])),_:1}),o(e,{type:"primary",onClick:$},{default:t(()=>a[4]||(a[4]=[b(" 确认 ")])),_:1})])]),default:t(()=>[o(u,{ref:"formRef",model:v,"label-width":"60px","status-icon":"",class:"form-wrapper"},{default:t(()=>[o(T,{label:"角色名",prop:"roleName"},{default:t(()=>[o(w,{modelValue:v.roleName,"onUpdate:modelValue":a[0]||(a[0]=V=>v.roleName=V),disabled:!0},null,8,["modelValue"])]),_:1}),o(N,{ref_key:"treeRef",ref:C,data:f.value,"show-checkbox":"","node-key":"id","default-checked-keys":y.value,"default-expanded-keys":[1],props:g},null,8,["data","default-checked-keys"])]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),re={class:"search-wrapper"},ne={class:"btn-wrapper"},se=j({name:"Role"}),ie=j({...se,setup(n){const l=c(),p=A({requestFn:J,showIndex:!0,showSelection:!0,columns:[{label:"ID",prop:"id",minWidth:80},{label:"角色名",prop:"roleName",minWidth:150},{label:"创建时间",prop:"createTime",minWidth:150,"show-overflow-tooltip":!0},{label:"更新时间",prop:"updateTime",minWidth:150,"show-overflow-tooltip":!0},{label:"操作",prop:"operation",minWidth:250,slot:"operation"}]}),i=c(!1);let d=c(""),g=c();const v=()=>{i.value=!0,d.value="A"},f=u=>{i.value=!0,d.value="U",g.value=u},y=c([]),x=()=>{H.confirm("确定删除选中角色?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const u=y.value.map(U=>U.id);(await Y(u,{showLoading:!0})).code===200?(k.success("删除成功"),l.value.getTableData()):k.error("删除失败")}catch{}})},C=async u=>{if(u.id)try{(await X(u.id)).code===200?(k.success("删除成功"),l.value.getTableData()):k.error("删除失败")}catch{}},$=()=>{l.value.getTableData()},_=c(!1),r=u=>{_.value=!0,g.value=u};let a=A({roleName:""});const w=c(),T=()=>{l.value.searchTable(a)},N=()=>{a.roleName="",l.value.searchTable()};return(u,e)=>{const U=s("el-input"),V=s("el-form-item"),D=s("el-button"),L=s("el-form"),K=s("el-popconfirm"),M=s("TableCreate"),S=s("el-card");return B(),F("div",null,[O("div",re,[o(L,{ref_key:"formRef",ref:w,inline:!0,model:h(a),class:"form-inline"},{default:t(()=>[o(V,{label:"角色名"},{default:t(()=>[o(U,{modelValue:h(a).roleName,"onUpdate:modelValue":e[0]||(e[0]=m=>h(a).roleName=m),placeholder:"请输入角色名关键字",clearable:""},null,8,["modelValue"])]),_:1}),o(V,{"label-width":"0"},{default:t(()=>[o(D,{type:"primary",onClick:T},{default:t(()=>e[4]||(e[4]=[b("搜索")])),_:1}),o(D,{type:"primary",onClick:N},{default:t(()=>e[5]||(e[5]=[b("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),O("div",ne,[o(D,{type:"primary",onClick:v},{default:t(()=>e[6]||(e[6]=[b(" 新增 ")])),_:1}),o(D,{type:"danger",onClick:x,disabled:!y.value.length},{default:t(()=>e[7]||(e[7]=[b(" 批量删除 ")])),_:1},8,["disabled"])]),o(S,{class:"box-card"},{default:t(()=>[o(M,{ref_key:"tableDom",ref:l,tableOptions:p,selectedRows:y.value,"onUpdate:selectedRows":e[1]||(e[1]=m=>y.value=m)},{operation:t(({scope:m})=>[o(D,{size:"small",type:"primary",onClick:E=>f(m.row)},{default:t(()=>e[8]||(e[8]=[b(" 修改 ")])),_:2},1032,["onClick"]),o(K,{title:`你确定要删除${m.row.roleName}?`,width:"260px",onConfirm:E=>C(m.row)},{reference:t(()=>[o(D,{type:"danger",size:"small"},{default:t(()=>e[9]||(e[9]=[b(" 删除 ")])),_:1})]),_:2},1032,["title","onConfirm"]),o(D,{size:"small",type:"primary",onClick:E=>r(m.row)},{default:t(()=>e[10]||(e[10]=[b(" 分配权限 ")])),_:2},1032,["onClick"])]),_:1},8,["tableOptions","selectedRows"])]),_:1}),i.value?(B(),I(te,{key:0,dialogVisible:i.value,"onUpdate:dialogVisible":e[2]||(e[2]=m=>i.value=m),rowData:h(g),action:h(d),onDialogConfirm:$},null,8,["dialogVisible","rowData","action"])):P("",!0),_.value?(B(),I(ae,{key:1,drawerVisible:_.value,"onUpdate:drawerVisible":e[3]||(e[3]=m=>_.value=m),rowData:h(g),onDrawerConfirm:$},null,8,["drawerVisible","rowData"])):P("",!0)])}}}),ue=G(ie,[["__scopeId","data-v-73619faf"]]);export{ue as default};
